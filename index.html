<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Customizable Text Spinner</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; margin: 0; background: #f0f0f0; }
  #controls { padding: 15px; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.15); display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
  #controls div { display: flex; flex-direction: column; min-width: 100px; }
  label { font-size: 0.9rem; margin-bottom: 4px; }
  input[type=text], input[type=number], input[type=color] { padding: 5px; font-size: 1rem; }
  button { padding: 10px 20px; font-size: 1rem; border: none; background: #0077cc; color: white; border-radius: 6px; cursor: pointer; }
  button:hover { background: #005fa3; }
  #colorPickers { display: flex; flex-wrap: wrap; gap: 5px; align-items: center; }
  #spinner-container { position: relative; margin: 20px auto; width: 500px; height: 500px; }
  #spinner { width: 100%; height: 100%; border-radius: 50%; touch-action: manipulation; }
  #arrow { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 40px; color: red; z-index: 10; }
</style>
</head>
<body>

<div id="controls">
  <div>
    <label for="items">Spinner Items (comma separated):</label>
    <input type="text" id="items" value="Apple,Banana,Cherry,Date">
  </div>
  <div>
    <label for="fontSize">Text Font Size (px):</label>
    <input type="number" id="fontSize" value="30" min="10" max="100">
  </div>
  <div>
    <label>Colors:</label>
    <div id="colorPickers">
      <input type="color" value="#ff6666">
      <input type="color" value="#66ccff">
      <input type="color" value="#99ff99">
      <button id="addColorBtn">+</button>
    </div>
  </div>
  <button id="buildBtn">Build Spinner</button>
</div>

<div id="spinner-container">
  <div id="arrow">â–¼</div>
  <canvas id="spinner"></canvas>
</div>

<script>
(() => {
  const canvas = document.getElementById("spinner");
  const ctx = canvas.getContext("2d");
  const buildBtn = document.getElementById("buildBtn");
  const addColorBtn = document.getElementById("addColorBtn");
  const colorPickersDiv = document.getElementById("colorPickers");
  const spinnerContainer = document.getElementById("spinner-container");

  let items = [];
  let colors = [];
  let angle = 0;
  let spinning = false;

  canvas.width = 500;
  canvas.height = 500;

  function getColors() {
    return Array.from(colorPickersDiv.querySelectorAll('input[type=color]')).map(input => input.value);
  }

  function buildSpinner() {
    const fontSizeInput = parseInt(document.getElementById("fontSize").value) || 30;
    colors = getColors();
    const rawItems = document.getElementById("items").value;
    items = rawItems.split(",").map(s => s.trim()).filter(s => s);

    drawSpinner(fontSizeInput);
  }

  function drawSpinner(fontSize) {
    const radius = canvas.width / 2;
    const sliceAngle = (2 * Math.PI) / items.length;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    items.forEach((item, i) => {
      const startAngle = i * sliceAngle;
      const endAngle = (i + 1) * sliceAngle;

      // slice
      ctx.beginPath();
      ctx.moveTo(radius, radius);
      ctx.arc(radius, radius, radius, startAngle, endAngle);
      ctx.closePath();
      ctx.fillStyle = colors[i % colors.length];
      ctx.fill();
      ctx.stroke();

      // text
      ctx.save();
      ctx.translate(radius, radius);
      ctx.rotate(startAngle + sliceAngle / 2);
      ctx.textAlign = "right";
      ctx.fillStyle = "#000";
      ctx.font = `bold ${fontSize}px Arial`;
      ctx.fillText(item, radius - 10, 10);
      ctx.restore();
    });
  }

   function spin() {
    if (spinning) return;
    spinning = true;

    // normalize angle to prevent huge values
    angle = angle % (2 * Math.PI);

    // determine rotations and random offset
    const extraRotations = Math.floor(Math.random() * 5) + 8;
    const randomOffset = Math.random() * 2 * Math.PI;
    const targetAngle = angle + extraRotations * 2 * Math.PI + randomOffset;

    // reset transition for instant jump to current angle
    canvas.style.transition = 'none';
    canvas.style.transform = `rotate(${angle}rad)`;

    // force reflow
    void canvas.offsetWidth;

    // animate spin
    canvas.style.transition = 'transform 3s cubic-bezier(0.33, 1, 0.68, 1)';
    canvas.style.transform = `rotate(${targetAngle}rad)`;

    setTimeout(() => {
        spinning = false;
        angle = targetAngle % (2 * Math.PI); // keep normalized
    }, 3000);
  }


  buildBtn.addEventListener("click", buildSpinner);
  spinnerContainer.addEventListener("click", spin);
  spinnerContainer.addEventListener("touchstart", spin);

  addColorBtn.addEventListener("click", () => {
    const newColor = document.createElement("input");
    newColor.type = "color";
    newColor.value = "#ffffff";
    colorPickersDiv.insertBefore(newColor, addColorBtn);
  });

  buildSpinner();
})();
</script>

</body>
</html>
